var w=Object.defineProperty;var C=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var c=(s,l,r)=>l in s?w(s,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[l]=r,u=(s,l)=>{for(var r in l||(l={}))x.call(l,r)&&c(s,r,l[r]);if(C)for(var r of C(l))T.call(l,r)&&c(s,r,l[r]);return s};var a=(s,l,r)=>(c(s,typeof l!="symbol"?l+"":l,r),r);(function(s,l){typeof exports=="object"&&typeof module!="undefined"?l(exports):typeof define=="function"&&define.amd?define(["exports"],l):(s=typeof globalThis!="undefined"?globalThis:s||self,l(s.CalendarGraph={}))})(this,function(s){"use strict";function l(o=new Date){let t=o.getFullYear();return t%4==0&&t%100!=0||t%400==0}function r(o=new Date){return new Date(o.getFullYear(),0,1)}function d(o=new Date){const t=Date.UTC(o.getFullYear(),o.getMonth(),o.getDate()),e=Date.UTC(o.getFullYear(),0,0);return(t-e)/1e3/60/60/24}class g{constructor(t,e){a(this,"width");a(this,"height");a(this,"gridData");this.offsetCellCount=t,this.options=e,this.init()}init(){let t=l()?366:365;this.gridData=new Array(t).fill(null).map((e,n)=>this.getCellPostionByDay(n+1)),this.setGridWidthHeight(t)}setGridWidthHeight(t){let{size:e,space:n}=this.options,i=Math.ceil((this.offsetCellCount+t)/7);this.width=i*e+(i-1)*n,this.height=7*e+6*n}getCellPostionByDay(t){let{size:e,space:n}=this.options,[i,h]=this.getCellRowColumnByDay(t),f=h*e+h*n,p=this.options.offsetY+i*e+i*n;return{x:f,y:p}}getCellRowColumnByDay(t){let{offsetCellCount:e}=this,n=Math.ceil((t+e)/7),i=7-(7*n-t-e);return n=n-1>0?n-1:0,i=i-1>0?i-1:0,[i,n]}static mergeData(t,e){const n=e.reduce((i,h)=>{let f=d(new Date(h.date))-1;return i[f]=h,i},{});for(let i=0;i<t.length;i++)t[i]=u(u({},t[i]),n[i]);return t}}class D{constructor(t){a(this,"monthTitleData");this.init(t)}init(t){this.monthTitleData=new Array(12).fill(null).map((e,n)=>{let i=this.getMonthColumn(n,t.offsetCellCount);return{title:n+1+"\u6708",x:i*t.size+i*t.space,y:t.titleHeight/2}})}getMonthColumn(t,e){let n=new Date(new Date().getFullYear(),t,1+e),i=d(n),h=n.getDay(),f=Math.ceil(i/7)-1;return h==1?f:f+1}}class y{constructor(t,e){a(this,"context");this.options=e,this.context=t.getContext("2d"),t.width=e.calendarWidth,t.height=e.calendarHeight,this.render()}render(t){this.context.clearRect(0,0,this.options.calendarWidth,this.options.calendarHeight);let{monthTitleData:e,gridData:n}=this.options;t&&t.length>0&&(n=g.mergeData(n,t)),this.renderMonthTitle(e),this.renderGrid(n)}renderMonthTitle(t){this.context.fillStyle=this.options.fontColor,this.context.font=this.options.font,this.context.textBaseline="middle",t.forEach(e=>{this.context.fillText(e.title,e.x,e.y)})}renderGrid(t){t.forEach(e=>{this.context.fillStyle=this.options.colorFunc(e.count||0),this.context.fillRect(e.x,e.y,this.options.size,this.options.size)})}}class m{constructor(t,e){a(this,"canvasGraph");a(this,"offsetCellCount",0);this.offsetCellCount=this.getOffsetCellCount(),this.canvasGraph=this.init(t,e)}init(t,e){let n=new D({offsetCellCount:this.offsetCellCount,size:e.size,space:e.space,titleHeight:e.titleHeight}),i=new g(this.offsetCellCount,{offsetY:e.titleHeight,size:e.size,space:e.space});return new y(t,{calendarWidth:i.width,calendarHeight:i.height+e.titleHeight,gridData:i.gridData,monthTitleData:n.monthTitleData,size:e.size,font:e.font,colorFunc:e.colorFunc,fontColor:e.fontColor})}getOffsetCellCount(){let t=0,e=r().getDay();return e==0?t=6:t=e-1,t}render(t){this.canvasGraph.render(t)}}s.CalendarGraph=m,Object.defineProperties(s,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
