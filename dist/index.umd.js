var y=Object.defineProperty;var _=Object.getOwnPropertySymbols;var w=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var f=(l,s,o)=>s in l?y(l,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[s]=o,d=(l,s)=>{for(var o in s||(s={}))w.call(s,o)&&f(l,o,s[o]);if(_)for(var o of _(s))x.call(s,o)&&f(l,o,s[o]);return l};var h=(l,s,o)=>(f(l,typeof s!="symbol"?s+"":s,o),o);(function(l,s){typeof exports=="object"&&typeof module!="undefined"?s(exports):typeof define=="function"&&define.amd?define(["exports"],s):(l=typeof globalThis!="undefined"?globalThis:l||self,s(l.CalendarGraph={}))})(this,function(l){"use strict";function s(a=new Date){let t=a.getFullYear();return t%4==0&&t%100!=0||t%400==0}function o(a=new Date){return new Date(a.getFullYear(),0,1)}function u(a=new Date){const t=Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()),e=Date.UTC(a.getFullYear(),0,0);return(t-e)/1e3/60/60/24}class g{constructor(t,e){h(this,"width");h(this,"height");h(this,"gridData");this.offsetCellCount=t,this.options=e,this.init()}init(){let t=s()?366:365;this.gridData=new Array(t).fill(null).map((e,i)=>this.getCellPostionByDay(i+1)),this.setGridWidthHeight(t)}setGridWidthHeight(t){let{size:e,space:i}=this.options,n=Math.ceil((this.offsetCellCount+t)/7);this.width=n*e+(n-1)*i,this.height=7*e+6*i}getCellPostionByDay(t){let{size:e,space:i}=this.options,[n,r]=this.getCellRowColumnByDay(t),c=r*e+r*i,m=this.options.offsetY+n*e+n*i;return{x:c,y:m}}getCellRowColumnByDay(t){let{offsetCellCount:e}=this,i=Math.ceil((t+e)/7),n=7-(7*i-t-e);return i=i-1>0?i-1:0,n=n-1>0?n-1:0,[n,i]}static mergeData(t,e){const i=e.reduce((n,r)=>{let c=u(new Date(r.date))-1;return n[c]=r,n},{});for(let n=0;n<t.length;n++)t[n]=d(d({},t[n]),i[n]);return t}}class C{constructor(t){h(this,"monthTitleData");this.init(t)}init(t){this.monthTitleData=new Array(12).fill(null).map((e,i)=>{let n=this.getMonthColumn(i,t.offsetCellCount);return{title:i+1+"\u6708",x:n*t.size+n*t.space,y:t.titleHeight/2}})}getMonthColumn(t,e){let i=new Date(new Date().getFullYear(),t,1+e),n=u(i),r=i.getDay(),c=Math.ceil(n/7)-1;return r==1?c:c+1}}class p{constructor(t,e){h(this,"_context");h(this,"_ratio");this.options=e,this._context=t.getContext("2d"),this._ratio=this.initRatio(e.devicePixelRatio,this._context),t.width=e.calendarWidth*this._ratio,t.height=e.calendarHeight*this._ratio,this.render()}initRatio(t,e){t=t||window.devicePixelRatio||1;let i=e.webkitBackingStorePixelRatio||1;return t/i}render(t){this._context.clearRect(0,0,this.options.calendarWidth,this.options.calendarHeight);let{monthTitleData:e,gridData:i}=this.options;t&&t.length>0&&(i=g.mergeData(i,t)),this.renderMonthTitle(e),this.renderGrid(i),this._context.scale(this._ratio,this._ratio)}renderMonthTitle(t){this._context.fillStyle=this.options.fontColor,this._context.font=this.options.font,this._context.textBaseline="middle",t.forEach(e=>{this._context.fillText(e.title,e.x,e.y)})}renderGrid(t){t.forEach(e=>{this._context.fillStyle=this.options.colorFunc(e.count||0),this._context.fillRect(e.x,e.y,this.options.size,this.options.size)})}}class D{constructor(t){h(this,"canvasWidth");h(this,"canvasHeight");h(this,"_monthTitle");h(this,"_grid");h(this,"_canvasGraph");this._options=t,this.init(t)}setCanvas(t){this._canvasGraph=new p(t,{devicePixelRatio:this._options.devicePixelRatio,calendarWidth:this.canvasWidth,calendarHeight:this.canvasHeight,gridData:this._grid.gridData,monthTitleData:this._monthTitle.monthTitleData,size:this._options.size,font:this._options.font,colorFunc:this._options.colorFunc,fontColor:this._options.fontColor})}init(t){let e=this.getOffsetCellCount();this._monthTitle=new C({offsetCellCount:e,size:t.size,space:t.space,titleHeight:t.titleHeight}),this._grid=new g(e,{offsetY:t.titleHeight,size:t.size,space:t.space}),this.canvasWidth=this._grid.width,this.canvasHeight=this._grid.height+t.titleHeight}getOffsetCellCount(){let t=0,e=o().getDay();return e==0?t=6:t=e-1,t}render(t){this._canvasGraph.render(t)}}l.CalendarGraph=D,Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
