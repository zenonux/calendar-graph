var w=Object.defineProperty;var C=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var f=(s,l,a)=>l in s?w(s,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[l]=a,u=(s,l)=>{for(var a in l||(l={}))x.call(l,a)&&f(s,a,l[a]);if(C)for(var a of C(l))T.call(l,a)&&f(s,a,l[a]);return s};var o=(s,l,a)=>(f(s,typeof l!="symbol"?l+"":l,a),a);(function(s,l){typeof exports=="object"&&typeof module!="undefined"?l(exports):typeof define=="function"&&define.amd?define(["exports"],l):(s=typeof globalThis!="undefined"?globalThis:s||self,l(s.CalendarGraph={}))})(this,function(s){"use strict";function l(r=new Date){let t=r.getFullYear();return t%4==0&&t%100!=0||t%400==0}function a(r=new Date){return new Date(r.getFullYear(),0,1)}function d(r=new Date){const t=Date.UTC(r.getFullYear(),r.getMonth(),r.getDate()),e=Date.UTC(r.getFullYear(),0,0);return(t-e)/1e3/60/60/24}class g{constructor(t,e){o(this,"width");o(this,"height");o(this,"gridData");this.offsetCellCount=t,this.options=e,this.init()}init(){let t=l()?366:365;this.gridData=new Array(t).fill(null).map((e,i)=>this.getCellPostionByDay(i+1)),this.setGridWidthHeight(t)}setGridWidthHeight(t){let{size:e,space:i}=this.options,n=Math.ceil((this.offsetCellCount+t)/7);this.width=n*e+(n-1)*i,this.height=7*e+6*i}getCellPostionByDay(t){let{size:e,space:i}=this.options,[n,h]=this.getCellRowColumnByDay(t),c=h*e+h*i,p=this.options.offsetY+n*e+n*i;return{x:c,y:p}}getCellRowColumnByDay(t){let{offsetCellCount:e}=this,i=Math.ceil((t+e)/7),n=7-(7*i-t-e);return i=i-1>0?i-1:0,n=n-1>0?n-1:0,[n,i]}static mergeData(t,e){const i=e.reduce((n,h)=>{let c=d(new Date(h.date))-1;return n[c]=h,n},{});for(let n=0;n<t.length;n++)t[n]=u(u({},t[n]),i[n]);return t}}class D{constructor(t){o(this,"monthTitleData");this.init(t)}init(t){this.monthTitleData=new Array(12).fill(null).map((e,i)=>{let n=this.getMonthColumn(i,t.offsetCellCount);return{title:i+1+"\u6708",x:n*t.size+n*t.space,y:t.titleHeight/2}})}getMonthColumn(t,e){let i=new Date(new Date().getFullYear(),t,1+e),n=d(i),h=i.getDay(),c=Math.ceil(n/7)-1;return h==1?c:c+1}}class y{constructor(t,e){o(this,"context");this.options=e,this.context=t.getContext("2d"),t.width=e.calendarWidth,t.height=e.calendarHeight,this.render()}render(t){this.context.clearRect(0,0,this.options.calendarWidth,this.options.calendarHeight);let{monthTitleData:e,gridData:i}=this.options;t&&t.length>0&&(i=g.mergeData(i,t)),this.renderMonthTitle(e),this.renderGrid(i)}renderMonthTitle(t){this.context.fillStyle=this.options.fontColor,this.context.font=this.options.font,this.context.textBaseline="middle",t.forEach(e=>{this.context.fillText(e.title,e.x,e.y)})}renderGrid(t){t.forEach(e=>{this.context.fillStyle=this.options.colorFunc(e.count||0),this.context.fillRect(e.x,e.y,this.options.size,this.options.size)})}}class m{constructor(t,e){o(this,"canvasWidth");o(this,"canvasHeight");o(this,"_canvasGraph");this._canvasGraph=this.init(t,e)}init(t,e){let i=this.getOffsetCellCount(),n=new D({offsetCellCount:i,size:e.size,space:e.space,titleHeight:e.titleHeight}),h=new g(i,{offsetY:e.titleHeight,size:e.size,space:e.space});return this.canvasWidth=h.width,this.canvasHeight=h.height+e.titleHeight,new y(t,{calendarWidth:this.canvasWidth,calendarHeight:this.canvasHeight,gridData:h.gridData,monthTitleData:n.monthTitleData,size:e.size,font:e.font,colorFunc:e.colorFunc,fontColor:e.fontColor})}getOffsetCellCount(){let t=0,e=a().getDay();return e==0?t=6:t=e-1,t}render(t){this._canvasGraph.render(t)}}s.CalendarGraph=m,Object.defineProperties(s,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
