var T=Object.defineProperty;var p=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var g=(a,r,h)=>r in a?T(a,r,{enumerable:!0,configurable:!0,writable:!0,value:h}):a[r]=h,w=(a,r)=>{for(var h in r||(r={}))G.call(r,h)&&g(a,h,r[h]);if(p)for(var h of p(r))Y.call(r,h)&&g(a,h,r[h]);return a};var f=(a,r,h)=>(g(a,typeof r!="symbol"?r+"":r,h),h);(function(a,r){typeof exports=="object"&&typeof module!="undefined"?r(exports):typeof define=="function"&&define.amd?define(["exports"],r):(a=typeof globalThis!="undefined"?globalThis:a||self,r(a.CalendarGraph={}))})(this,function(a){"use strict";function r(s=new Date){let e=s.getFullYear();return e%4==0&&e%100!=0||e%400==0}function h(s=new Date){return new Date(s.getFullYear(),0,1)}function c(s=new Date){const e=Date.UTC(s.getFullYear(),s.getMonth(),s.getDate()),i=Date.UTC(s.getFullYear(),0,0);return(e-i)/1e3/60/60/24}function C(s="#000",e=.5){if(e=Math.max(e,0),e=Math.min(e,1),s=s.replace(/\#/g,"").toUpperCase(),s.length===3){let l=s.split("");s="";for(let o=0;o<l.length;o++)s+=l[o]+l[o]}let i=Math.round(255*e),t="",n=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];for(;i>0;){let l=i%16;i=(i-l)/16,t=n[l]+t}return t.length==1&&(t="0"+t),t.length==0&&(t="00"),`#${s+t}`}class y{constructor(e,i){f(this,"data");this.init(e,i)}init(e,i){let t=new Array(12).fill(null).map((n,l)=>({title:l+1+"\u6708",column:this.getMonthColumn(l,i.offsetCellCount)}));this.render(e,t,i)}getMonthColumn(e,i){let t=new Date(new Date().getFullYear(),e,1+i),n=c(t),l=t.getDay(),o=Math.ceil(n/7)-1;return l==1?o:o+1}render(e,i,t){i.map((l,o)=>({title:l.title,x:l.column*t.size+(l.column-1>0?l.column-1:0)*t.space,y:t.height/2})).forEach(l=>{this.drawText(e,l.title,l.x,l.y,t.font,t.color)})}drawText(e,i,t,n,l,o){e.font=l,e.fillStyle=o,e.textBaseline="middle",e.fillText(i,t,n)}}class D{constructor(e,i){f(this,"offsetCellCount",0);f(this,"context");f(this,"options");f(this,"gridWidth");f(this,"gridHeight");this.offsetCellCount=this.getOffsetCellCount(),this.context=e.getContext("2d"),this.options=i,this.draw()}draw(){new y(this.context,w({height:this.options.text.height,size:this.options.grid.size,offsetCellCount:this.offsetCellCount,space:this.options.grid.space},this.options.text)),this.drawGrid()}render(e){this.context.clearRect(0,this.options.text.height,this.gridWidth,this.gridHeight),this.drawGrid(e)}setGridWidthHeight(e){let{size:i,space:t}=this.options.grid,n=Math.ceil((this.offsetCellCount+e)/7);this.gridWidth=n*i+(n-1)*t,this.gridHeight=7*i+6*t}drawGrid(e){let i=r()?366:365,t=new Array(i).fill(null);if(this.gridWidth||this.setGridWidthHeight(i),e){const n=e.reduce((l,o)=>{let d=c(new Date(o.date));return l[d]=o,l},{});for(let l=0;l<t.length;l++)t[l]=n[l]}t.forEach((n,l)=>{this.drawRect(l+1,n?n.count:0)})}drawRect(e,i){let{size:t,space:n,defaultColor:l,primaryColor:o}=this.options.grid,[d,m]=this.getDayCellRowColumn(e),x=m*t+m*n,M=d*t+d*n,u=l;i>2?u=o:i==2?u=C(o,.8):i==1&&(u=C(o,.5)),this.context.fillStyle=u,this.context.fillRect(x,this.options.text.height+M,t,t)}getDayCellRowColumn(e){let{offsetCellCount:i}=this,t=Math.ceil((e+i)/7),n=7-(7*t-e-i);return t=t-1>0?t-1:0,n=n-1>0?n-1:0,[n,t]}getOffsetCellCount(){let e=0,i=h().getDay();return i==0?e=6:e=i-1,e}}a.CalendarGraph=D,Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
