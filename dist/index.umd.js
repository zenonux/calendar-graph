var w=Object.defineProperty;var C=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var f=(l,s,o)=>s in l?w(l,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[s]=o,u=(l,s)=>{for(var o in s||(s={}))_.call(s,o)&&f(l,o,s[o]);if(C)for(var o of C(s))x.call(s,o)&&f(l,o,s[o]);return l};var a=(l,s,o)=>(f(l,typeof s!="symbol"?s+"":s,o),o);(function(l,s){typeof exports=="object"&&typeof module!="undefined"?s(exports):typeof define=="function"&&define.amd?define(["exports"],s):(l=typeof globalThis!="undefined"?globalThis:l||self,s(l.CalendarGraph={}))})(this,function(l){"use strict";function s(h=new Date){let t=h.getFullYear();return t%4==0&&t%100!=0||t%400==0}function o(h=new Date){return new Date(h.getFullYear(),0,1)}function d(h=new Date){const t=Date.UTC(h.getFullYear(),h.getMonth(),h.getDate()),e=Date.UTC(h.getFullYear(),0,0);return(t-e)/1e3/60/60/24}class g{constructor(t,e){a(this,"width");a(this,"height");a(this,"gridData");this.offsetCellCount=t,this.options=e,this.init()}init(){let t=s()?366:365;this.gridData=new Array(t).fill(null).map((e,i)=>this.getCellPostionByDay(i+1)),this.setGridWidthHeight(t)}setGridWidthHeight(t){let{size:e,space:i}=this.options,n=Math.ceil((this.offsetCellCount+t)/7);this.width=n*e+(n-1)*i,this.height=7*e+6*i}getCellPostionByDay(t){let{size:e,space:i}=this.options,[n,r]=this.getCellRowColumnByDay(t),c=r*e+r*i,y=this.options.offsetY+n*e+n*i;return{x:c,y}}getCellRowColumnByDay(t){let{offsetCellCount:e}=this,i=Math.ceil((t+e)/7),n=7-(7*i-t-e);return i=i-1>0?i-1:0,n=n-1>0?n-1:0,[n,i]}static mergeData(t,e){const i=e.reduce((n,r)=>{let c=d(new Date(r.date))-1;return n[c]=r,n},{});for(let n=0;n<t.length;n++)t[n]=u(u({},t[n]),i[n]);return t}}class p{constructor(t){a(this,"monthTitleData");this.init(t)}init(t){this.monthTitleData=new Array(12).fill(null).map((e,i)=>{let n=this.getMonthColumn(i,t.offsetCellCount);return{title:i+1+"\u6708",x:n*t.size+n*t.space,y:t.titleHeight/2}})}getMonthColumn(t,e){let i=new Date(new Date().getFullYear(),t,1+e),n=d(i),r=i.getDay(),c=Math.ceil(n/7)-1;return r==1?c:c+1}}class D{constructor(t,e){a(this,"context");this.options=e,this.context=t.getContext("2d"),t.width=e.calendarWidth,t.height=e.calendarHeight,this.render()}render(t){this.context.clearRect(0,0,this.options.calendarWidth,this.options.calendarHeight);let{monthTitleData:e,gridData:i}=this.options;t&&t.length>0&&(i=g.mergeData(i,t)),this.renderMonthTitle(e),this.renderGrid(i)}renderMonthTitle(t){this.context.fillStyle=this.options.fontColor,this.context.font=this.options.font,this.context.textBaseline="middle",t.forEach(e=>{this.context.fillText(e.title,e.x,e.y)})}renderGrid(t){t.forEach(e=>{this.context.fillStyle=this.options.colorFunc(e.count||0),this.context.fillRect(e.x,e.y,this.options.size,this.options.size)})}}class m{constructor(t){a(this,"canvasWidth");a(this,"canvasHeight");a(this,"_monthTitle");a(this,"_grid");a(this,"_canvasGraph");this._options=t,this.init(t)}setCanvas(t){this._canvasGraph=new D(t,{calendarWidth:this.canvasWidth,calendarHeight:this.canvasHeight,gridData:this._grid.gridData,monthTitleData:this._monthTitle.monthTitleData,size:this._options.size,font:this._options.font,colorFunc:this._options.colorFunc,fontColor:this._options.fontColor})}init(t){let e=this.getOffsetCellCount();this._monthTitle=new p({offsetCellCount:e,size:t.size,space:t.space,titleHeight:t.titleHeight}),this._grid=new g(e,{offsetY:t.titleHeight,size:t.size,space:t.space}),this.canvasWidth=this._grid.width,this.canvasHeight=this._grid.height+t.titleHeight}getOffsetCellCount(){let t=0,e=o().getDay();return e==0?t=6:t=e-1,t}render(t){this._canvasGraph.render(t)}}l.CalendarGraph=m,Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
